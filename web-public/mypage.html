<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ãƒžã‚¤ãƒšãƒ¼ã‚¸</title>
  <link rel="stylesheet" href="/css/style.css" />
</head>

<body>
  <div class="container">
    <h1>ãƒžã‚¤ãƒšãƒ¼ã‚¸</h1>
    <table>
      <tr>
        <th>IDãƒˆãƒ¼ã‚¯ãƒ³</th>
        <td><textarea id="idToken" rows="10" cols="80"></textarea></td>
        <td><button onclick="exec('idToken')">Check</button></td>
      </tr>
      <tr>
        <th>ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³</th>
        <td><textarea id="accessToken" rows="10" cols="80"></textarea></td>
        <td><button onclick="exec('accessToken')">Check</button></td>
      </tr>
      <tr>
        <th>ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒˆãƒ¼ã‚¯ãƒ³</th>
        <td><textarea id="refreshToken" rows="10" cols="80"></textarea></td>
        <td><button onclick="exec('refreshToken')">Refresh</button></td>
      </tr>
    </table>
  </div>

  <script>
    const idTokenTextArea = document.getElementById('idToken');
    const accessTokenTextArea = document.getElementById('accessToken');
    const refreshTokenTextArea = document.getElementById('refreshToken');
    const savedIdToken = window.localStorage.getItem('idToken');
    const savedAccessToken = window.localStorage.getItem('accessToken');
    const savedRefreshToken = window.localStorage.getItem('refreshToken');
    idTokenTextArea.value = savedIdToken;
    accessTokenTextArea.value = savedAccessToken;
    refreshTokenTextArea.value = savedRefreshToken;

    function checkIdToken() {
      const idToken = idTokenTextArea.value;
      fetch(`/api/auth/check-token?token=${idToken}`)
        .then((response) => response.json())
        .then((data) => {
          if (data == null) {
            window.alert('Invalid token ðŸš¨ðŸš¨ðŸš¨');
            return;
          }
          window.alert(`Valid token ðŸŽ‰ðŸŽ‰ðŸŽ‰\n${JSON.stringify(data)}`);
        });
    }

    function checkAccessToken() {
      const accessToken = accessTokenTextArea.value;
      fetch(`/api/auth/check-token?token=${accessToken}`)
        .then((response) => response.json())
        .then((data) => {
          if (data == null) {
            window.alert('Invalid token ðŸš¨ðŸš¨ðŸš¨');
            return;
          }
          window.alert(`Valid token ðŸŽ‰ðŸŽ‰ðŸŽ‰\n${JSON.stringify(data)}`);
        });
    }

    function refreshRefreshToken() {
      const refreshToken = refreshTokenTextArea.value;
      fetch(`/api/auth/refresh-token?token=${refreshToken}`)
        .then((response) => response.json())
        .then((data) => {
          if (data == null) {
            window.alert('Failed to refresh token ðŸš¨ðŸš¨ðŸš¨');
            return;
          }
          const newIdToken = data.id_token;
          const newAccessToken = data.access_token;
          window.localStorage.setItem('idToken', newIdToken);
          window.localStorage.setItem('accessToken', newAccessToken);
          idTokenTextArea.value = newIdToken;
          accessTokenTextArea.value = newAccessToken;
          window.alert(`Refreshed token ðŸŽ‰ðŸŽ‰ðŸŽ‰\n${JSON.stringify(data)}`);
        });
    }

    function exec(tokenName) {
      switch (tokenName) {
        case 'idToken':
          checkIdToken();
          break;
        case 'accessToken':
          checkAccessToken();
          break;
        case 'refreshToken':
          refreshRefreshToken();
          break;
      }
    }
  </script>
</body>

</html>
